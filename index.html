<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clue: The Floors of Mystery</title>
<style>
body { text-align:center; font-family:sans-serif; position: relative; }
#hud { margin-bottom:10px; font-size:16px; }
#hud p { margin:2px; }
#gameContainer { display:flex; justify-content:center; align-items:flex-start; }
canvas { background-color:#b4b4b4; display:block; margin:5px; border:1px solid black; }
#cheatDisplay { font-size:16px; margin-top:10px; }
#mapButton, #instructionButton { margin:10px; padding:5px 10px; font-size:16px; }
#instructions {
 display:none;
 position:absolute;
 left:10px;
 top:100px;
 background-color:#f0f0f0;
 padding:10px;
 border:1px solid #000;
 text-align:left;
}
#buttonControls {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  display: none; /* hidden by default */
}
#buttonControls button {
  font-size: 28px;
  padding: 15px 20px;
  margin: 5px;
}
</style>
</head>
<body>
<h2>Clue: The Floors of Mystery</h2>

<div id="hud">
 <p id="roomInfo">Room: KITCHEN</p>
 <p id="floorInfo">Floor: 1</p>
 <p id="scoreInfo">Score: 0</p>
 <p id="weaponsInfo">Weapons: 0/requiredWeapons</p>
 <p id="livesInfo">Lives: 3</p>
</div>

<div id="gameContainer">
 <canvas id="gameCanvas" width="800" height="600"></canvas>
 <canvas id="mapCanvas" width="300" height="600" style="display:none;"></canvas>
</div>

<div>
 <button id="mapButton">Toggle Map</button>
 <button id="instructionButton">Toggle Instructions</button>
</div>

<div id="cheatDisplay">Cheat Code: </div>

<p id="instructions">
1. Use the arrow keys to travel between rooms. <br>
2. Navigate the mansion to collect all six weapons. <br>
3. Avoid the guards! Each guard hit costs a life. <br>
4. You have 3 lives. Lose all, and it's Game Over. <br>
5. Check the map to view your location.
</p>

<!-- Mobile Arrow Buttons -->
<div id="buttonControls">
  <div>
    <button data-dir="up">⬆️</button>
  </div>
  <div>
    <button data-dir="left">⬅️</button>
    <button data-dir="down">⬇️</button>
    <button data-dir="right">➡️</button>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mapCanvas = document.getElementById('mapCanvas');
const mapCtx = mapCanvas.getContext('2d');

let stairCooldown = 0;
let vkyekoCooldown = 0;

const roomInfo = document.getElementById("roomInfo");
const floorInfo = document.getElementById("floorInfo");
const scoreInfo = document.getElementById("scoreInfo");
const weaponsInfo = document.getElementById("weaponsInfo");
const livesInfo = document.getElementById("livesInfo");

const player = {x:50, y:50, w:25, h:25, speed:5};
let score = 0;
let collected = [];
let currentRoom = "BALLROOM";
let showMap = false;
let lives = 3;
let gameOver = false;

// Guards
let guards = [
  {x:200,y:150,w:25,h:25,speed:2,dx:1,dy:0,room:"BALLROOM"},
  {x:500,y:400,w:25,h:25,speed:1.5,dx:0,dy:1,room:"DINING ROOM"}
];

let requiredWeapons = 6;
let deathPenalty = 1;

const cheatCodes = {
  "INZPYL": () => {
    for (let i = 0; i < 15; i++) {
      guards.push({
        x: Math.random() * 700 + 50,
        y: Math.random() * 500 + 50,
        w: 25,
        h: 25,
        speed: 1 + Math.random() * 2,
        dx: Math.floor(Math.random() * 3) - 1,
        dy: Math.floor(Math.random() * 3) - 1,
        room: currentRoom
      });
    }
  },
  "ESPTVX": () => { requiredWeapons += 18; spawnExtraWeapons(18); },
  "VKYEKO": () => {
    if (vkyekoCooldown > 0) { alert("VKYEKO on cooldown!"); return; }
    vkyekoCooldown = 300;
    let allRooms = Object.keys(ROOMS);
    let changed = 0;
    for (const r of allRooms) {
      for (const d of ROOMS[r].doors) {
        if (changed >= 3) return;
        let wrong;
        do { wrong = allRooms[Math.floor(Math.random()*allRooms.length)]; } while (wrong === d.to);
        d.to = wrong;
        changed++;
      }
    }
  },
  "LNVNLS": () => { lives += 8; updateHUD(); },
  "VKOGPZ": () => {
    let allRooms = Object.keys(ROOMS);
    for (let i = 0; i < 9; i++) {
      const from = ROOMS[allRooms[Math.floor(Math.random()*allRooms.length)]];
      const to = allRooms[Math.floor(Math.random()*allRooms.length)];
      from.doors.push({
        x: (Math.random() < 0.5 ? 0 : 1) * 800,
        y: Math.random() * 500 + 20,
        w: 20, h: 80, to
      });
    }
  },
  "NKUGLA": () => { deathPenalty = 4; }
};

let cheatBuffer = "";
const cheatDisplay = document.getElementById('cheatDisplay');

// --- Cheat typing only ---
document.addEventListener('keydown', e => {
  if(gameOver) return;
  const key = e.key.toUpperCase();
  if(/^[A-Z]$/.test(key)){
    cheatBuffer += key;
    cheatDisplay.textContent = "Cheat Code: " + cheatBuffer;
    for(const code in cheatCodes){
      if(cheatBuffer.endsWith(code)){
        cheatCodes[code]();
        cheatBuffer = "";
        cheatDisplay.textContent = "Type Here: ";
      }
    }
  }
  if(e.key === "Backspace"){
    cheatBuffer = cheatBuffer.slice(0,-1);
    cheatDisplay.textContent = "Cheat Code: " + cheatBuffer;
  }
});

// --- Keyboard movement ---
const keysPressed = {};
document.addEventListener('keydown', e => { if(!gameOver) keysPressed[e.key] = true; });
document.addEventListener('keyup', e => { if(!gameOver) keysPressed[e.key] = false; });

function handleKeyboardMovement(){
  if(keysPressed["ArrowLeft"]) moveFromButton("left");
  if(keysPressed["ArrowRight"]) moveFromButton("right");
  if(keysPressed["ArrowUp"]) moveFromButton("up");
  if(keysPressed["ArrowDown"]) moveFromButton("down");
  requestAnimationFrame(handleKeyboardMovement);
}
handleKeyboardMovement();

// --- Mobile arrows ---
function isMobileDevice() {
  return /Android|iPhone|iPad|iPod|Mobile|Tablet/i.test(navigator.userAgent);
}

if(isMobileDevice()){
  const buttonControls = document.createElement("div");
  buttonControls.id = "buttonControls";
  buttonControls.style.display = "block";
  buttonControls.innerHTML = `
    <button data-dir="up">↑</button>
    <br>
    <button data-dir="left">←</button>
    <button data-dir="down">↓</button>
    <button data-dir="right">→</button>
  `;
  document.body.appendChild(buttonControls);

  const arrowButtons = buttonControls.querySelectorAll("button");
  const activeDirs = {};

  arrowButtons.forEach(btn=>{
    const dir = btn.getAttribute("data-dir");
    btn.addEventListener("touchstart", e=>{ e.preventDefault(); activeDirs[dir]=true; });
    btn.addEventListener("touchend", e=>{ e.preventDefault(); activeDirs[dir]=false; });
  });

  function handleTouchMovement(){
    for(const dir in activeDirs){
      if(activeDirs[dir]) moveFromButton(dir);
    }
    requestAnimationFrame(handleTouchMovement);
  }
  handleTouchMovement();
}

// --- Movement function ---
function moveFromButton(direction){
  if(gameOver) return;
  const prevX = player.x;
  const prevY = player.y;

  if(direction==="left") player.x -= player.speed;
  if(direction==="right") player.x += player.speed;
  if(direction==="up") player.y -= player.speed;
  if(direction==="down") player.y += player.speed;

  handleCollisions(prevX, prevY);
  updateHUD();
}

// --- Game loop ---
function update(){
  if(vkyekoCooldown>0) vkyekoCooldown--;
  draw();
  requestAnimationFrame(update);
}

ctx.font="16px sans-serif";
mapCtx.font="12px sans-serif";
update();
updateHUD();
</script>
<div id="buttonControls" style="display:none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100;">
  <div style="text-align:center;">
    <button data-dir="up">↑</button>
  </div>
  <div style="display:flex; justify-content:center;">
    <button data-dir="left">←</button>
    <button data-dir="down" style="margin: 0 10px;">↓</button>
    <button data-dir="right">→</button>
  </div>
</div>
</body>
</html>
