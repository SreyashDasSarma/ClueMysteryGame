<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clue: The Floors of Mystery</title>
<style>
body { text-align:center; font-family:sans-serif; position: relative; }
#hud { margin-bottom:10px; font-size:16px; }
#hud p { margin:2px; }
#gameContainer { display:flex; justify-content:center; align-items:flex-start; }
canvas { background-color:#b4b4b4; display:block; margin:5px; border:1px solid black; }
#cheatDisplay { font-size:16px; margin-top:10px; }
#mapButton, #instructionButton { margin:10px; padding:5px 10px; font-size:16px; }
#instructions {
 display:none;
 position:absolute;
 left:10px;
 top:100px;
 background-color:#f0f0f0;
 padding:10px;
 border:1px solid #000;
 text-align:left;
}
#buttonControls {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  display: none; /* hidden by default, shown on mobile */
}
#buttonControls button {
  font-size: 28px;
  padding: 15px 20px;
  margin: 5px;
}
</style>
</head>
<body>
<h2>Clue: The Floors of Mystery</h2>

<div id="hud">
 <p id="roomInfo">Room: KITCHEN</p>
 <p id="floorInfo">Floor: 1</p>
 <p id="scoreInfo">Score: 0</p>
 <p id="weaponsInfo">Weapons: 0/requiredWeapons</p>
 <p id="livesInfo">Lives: 3</p>
</div>

<div id="gameContainer">
 <canvas id="gameCanvas" width="800" height="600"></canvas>
 <canvas id="mapCanvas" width="300" height="600" style="display:none;"></canvas>
</div>

<div>
 <button id="mapButton">Toggle Map</button>
 <button id="instructionButton">Toggle Instructions</button>
</div>

<div id="cheatDisplay">Type Here: </div>

<p id="instructions">
1. Use the arrow keys to travel between rooms. <br>
2. Navigate the mansion to collect all six weapons. <br>
3. Avoid the guards! Each guard hit costs a life. <br>
4. You have 3 lives. Lose all, and it's Game Over. <br>
5. Check the map to view your location.
</p>

<!-- Mobile Arrow Buttons -->
<div id="buttonControls">
  <div>
    <button data-dir="up">⬆️</button>
  </div>
  <div>
    <button data-dir="left">⬅️</button>
    <button data-dir="down">⬇️</button>
    <button data-dir="right">➡️</button>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mapCanvas = document.getElementById('mapCanvas');
const mapCtx = mapCanvas.getContext('2d');
let stairCooldown = 0;
let vkyekoCooldown = 0;

const roomInfo = document.getElementById("roomInfo");
const floorInfo = document.getElementById("floorInfo");
const scoreInfo = document.getElementById("scoreInfo");
const weaponsInfo = document.getElementById("weaponsInfo");
const livesInfo = document.getElementById("livesInfo");

const player = {x:50,y:50,w:25,h:25,speed:5};
let score = 0;
let collected = [];
let currentRoom = "BALLROOM";
let showMap = false;
let lives = 3;
let gameOver = false;

// ---------- GUARDS ----------
let guards = [
 {x:200,y:150,w:25,h:25,speed:2,dx:1,dy:0,room:"BALLROOM"},
 {x:500,y:400,w:25,h:25,speed:1.5,dx:0,dy:1,room:"DINING ROOM"}
];

let requiredWeapons = 6;
let deathPenalty = 1;

// ---------- ROOMS ----------
const ROOMS = {
  "KITCHEN":{
    floor:1,
    weapons:[{name:"Knife",x:50,y:50,w:20,h:20}],
    walls:[
      {x:0,y:0,w:800,h:10},
      {x:0,y:0,w:10,h:600},
      {x:790,y:0,w:10,h:600},
      {x:0,y:590,w:800,h:10}
    ],
    doors:[{x:780,y:250,w:20,h:100,to:"BALLROOM"}],
    stairs:null
  },
  "BALLROOM":{
    floor:1,
    weapons:[{name:"Candlestick",x:300,y:100,w:20,h:20}],
    walls:[
      {x:0,y:0,w:800,h:10},
      {x:0,y:0,w:10,h:600},
      {x:790,y:0,w:10,h:600},
      {x:0,y:590,w:800,h:10}
    ],
    doors:[
      {x:0,y:250,w:20,h:100,to:"KITCHEN"},
      {x:350,y:580,w:100,h:20,to:"DINING ROOM"},
      {x:780,y:100,w:20,h:100,to:"HALL"}
    ],
    stairs:null
  },
  // ... include all other rooms as in your original code
};

// ---------- FUNCTIONS ----------
function moveFromButton(direction){
  if(gameOver) return;
  const prevX = player.x;
  const prevY = player.y;
  if(direction==="left") player.x -= player.speed;
  if(direction==="right") player.x += player.speed;
  if(direction==="up") player.y -= player.speed;
  if(direction==="down") player.y += player.speed;
  handleCollisions(prevX, prevY);
  updateHUD();
}

// ---------- COLLISIONS ----------
function handleCollisions(prevX, prevY){
  const room = ROOMS[currentRoom];
  if(stairCooldown>0) stairCooldown--;
  player.x = Math.max(10, Math.min(player.x, 790-player.w));
  player.y = Math.max(10, Math.min(player.y, 590-player.h));
  for(const w of room.walls){
    if(player.x+player.w > w.x && player.x < w.x + w.w &&
       player.y+player.h > w.y && player.y < w.y + w.h){
         player.x = prevX;
         player.y = prevY;
    }
  }
}

// ---------- HUD ----------
function updateHUD(){
 const room = ROOMS[currentRoom];
 roomInfo.textContent = "Room: " + currentRoom;
 floorInfo.textContent = "Floor: " + room.floor;
 scoreInfo.textContent = "Score: " + score;
 weaponsInfo.textContent = "Weapons: " + collected.length + "/" + requiredWeapons;
 livesInfo.textContent = "Lives: " + lives;
}

// ---------- DRAW ----------
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const room = ROOMS[currentRoom];
  ctx.fillStyle="#FFC8C8";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#000";
  for(const w of room.walls) ctx.fillRect(w.x,w.y,w.w,w.h);
  ctx.fillStyle="#FFD700";
  for(const d of room.doors) ctx.fillRect(d.x,d.y,d.w,d.h);
  ctx.fillStyle="#3264FF";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

// ---------- UPDATE LOOP ----------
function update(){
  draw();
  requestAnimationFrame(update);
}
ctx.font="16px sans-serif";
mapCtx.font="12px sans-serif";
update();
updateHUD();

// ---------- MAP ----------
document.getElementById("mapButton").addEventListener("click",()=>{
  showMap=!showMap;
  mapCanvas.style.display=showMap?"block":"none";
});

// ---------- INSTRUCTIONS ----------
const instructionButton = document.getElementById("instructionButton");
const instructions = document.getElementById("instructions");
instructionButton.addEventListener("click", () => {
 if (instructions.style.display === "none") instructions.style.display = "block";
 else instructions.style.display = "none";
});

// ---------- KEYBOARD ----------
const keysPressed = {};
document.addEventListener('keydown', e=>{
  if(gameOver) return;
  keysPressed[e.key] = true;
});
document.addEventListener('keyup', e=>{
  keysPressed[e.key] = false;
});

function handleKeyboardMovement(){
  if(keysPressed["ArrowLeft"]) moveFromButton("left");
  if(keysPressed["ArrowRight"]) moveFromButton("right");
  if(keysPressed["ArrowUp"]) moveFromButton("up");
  if(keysPressed["ArrowDown"]) moveFromButton("down");
  requestAnimationFrame(handleKeyboardMovement);
}
handleKeyboardMovement();

// ---------- MOBILE ARROWS ----------
function isMobileDevice() {
  return /Android|iPhone|iPad|iPod|Mobile|Tablet/i.test(navigator.userAgent);
}

if(isMobileDevice()){
  const buttonControls = document.getElementById("buttonControls");
  buttonControls.style.display = "block";

  const arrowButtons = buttonControls.querySelectorAll("button");
  const activeDirs = {};

  arrowButtons.forEach(btn=>{
    const dir = btn.getAttribute("data-dir");

    btn.addEventListener("touchstart", e=>{
      e.preventDefault();
      activeDirs[dir] = true;
    });
    btn.addEventListener("touchend", e=>{
      e.preventDefault();
      activeDirs[dir] = false;
    });
  });

  function handleTouchMovement(){
    for(const dir in activeDirs){
      if(activeDirs[dir]) moveFromButton(dir);
    }
    requestAnimationFrame(handleTouchMovement);
  }
  handleTouchMovement();
}
</script>
</body>
</html>
