<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clue: The Floors of Mystery</title>
<style>
body { text-align:center; font-family:sans-serif; position: relative; }
#hud { margin-bottom:10px; font-size:16px; }
#hud p { margin:2px; }
#gameContainer { display:flex; justify-content:center; align-items:flex-start; }
canvas { background-color:#b4b4b4; display:block; margin:5px; border:1px solid black; }
#cheatDisplay { font-size:16px; margin-top:10px; }
#mapButton, #instructionButton { margin:10px; padding:5px 10px; font-size:16px; }
#instructions {
 display:none;
 position:absolute;
 left:10px;
 top:100px;
 background-color:#f0f0f0;
 padding:10px;
 border:1px solid #000;
 text-align:left;
}

#buttonControls {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
}

#buttonControls button {
  font-size: 28px;
  padding: 15px 20px;
  margin: 5px;
}
</style>
</head>

<body>
<h2>Clue: The Floors of Mystery</h2>

<div id="hud">
 <p id="roomInfo">Room: KITCHEN</p>
 <p id="floorInfo">Floor: 1</p>
 <p id="scoreInfo">Score: 0</p>
 <p id="weaponsInfo">Weapons: 0/requiredWeapons</p>
 <p id="livesInfo">Lives: 3</p>
</div>

<div id="gameContainer">
 <canvas id="gameCanvas" width="800" height="600"></canvas>
 <canvas id="mapCanvas" width="300" height="600" style="display:none;"></canvas>
</div>

<div>
 <button id="mapButton">Toggle Map</button>
 <button id="instructionButton">Toggle Instructions</button>
</div>

<div id="cheatDisplay">Type Here: </div>

<p id="instructions">
1. Use the arrow keys or buttons to move.<br>
2. Navigate the mansion to collect all weapons.<br>
3. Avoid the guards! Each hit costs a life.<br>
4. You have 3 lives. Lose all, and it's Game Over.<br>
5. Check the map to view your location.
</p>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mapCanvas = document.getElementById('mapCanvas');
const mapCtx = mapCanvas.getContext('2d');

let stairCooldown = 0;
let vkyekoCooldown = 0;

const roomInfo = document.getElementById("roomInfo");
const floorInfo = document.getElementById("floorInfo");
const scoreInfo = document.getElementById("scoreInfo");
const weaponsInfo = document.getElementById("weaponsInfo");
const livesInfo = document.getElementById("livesInfo");

const player = {x:50,y:50,w:25,h:25,speed:5};
let score = 0;
let collected = [];
let currentRoom = "BALLROOM";
let showMap = false;
let lives = 3;
let gameOver = false;

/* ---------- HOLD MOVEMENT SYSTEM ---------- */
let moveInterval = null;
let moveDir = null;

function startMove(dir) {
  if (gameOver) return;
  moveDir = dir;
  if (moveInterval) return;

  moveInterval = setInterval(() => {
    const prevX = player.x;
    const prevY = player.y;

    if (moveDir === "left") player.x -= player.speed;
    if (moveDir === "right") player.x += player.speed;
    if (moveDir === "up") player.y -= player.speed;
    if (moveDir === "down") player.y += player.speed;

    handleCollisions(prevX, prevY);
    updateHUD();
  }, 40);
}

function stopMove() {
  clearInterval(moveInterval);
  moveInterval = null;
  moveDir = null;
}

/* ---------- KEYBOARD SUPPORT ---------- */
document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") startMove("left");
  if (e.key === "ArrowRight") startMove("right");
  if (e.key === "ArrowUp") startMove("up");
  if (e.key === "ArrowDown") startMove("down");
});

document.addEventListener("keyup", e => {
  if (e.key.startsWith("Arrow")) stopMove();
});

/* ---------- GUARDS ---------- */
let guards = [
 {x:200,y:150,w:25,h:25,speed:2,dx:1,dy:0,room:"BALLROOM"},
 {x:500,y:400,w:25,h:25,speed:1.5,dx:0,dy:1,room:"DINING ROOM"}
];

function moveGuards(){
 for(const g of guards){
   if(g.room !== currentRoom) continue;
   g.x += g.dx * g.speed;
   g.y += g.dy * g.speed;

   g.x = Math.max(10, Math.min(g.x, 790-g.w));
   g.y = Math.max(10, Math.min(g.y, 590-g.h));

   if(Math.random() < 0.01){
     g.dx = Math.floor(Math.random()*3)-1;
     g.dy = Math.floor(Math.random()*3)-1;
   }

   if(player.x < g.x+g.w && player.x+player.w > g.x &&
      player.y < g.y+g.h && player.y+player.h > g.y){
     lives--;
     updateHUD();
     if(lives <= 0){
       gameOver = true;
       alert("Game Over!");
     } else {
       player.x = 50;
       player.y = 50;
     }
   }
 }
}

/* ---------- ROOMS / COLLISIONS / DRAW ---------- */
/* (UNCHANGED — exactly your logic) */

function handleCollisions(prevX, prevY){
 const room = ROOMS[currentRoom];
 if (stairCooldown > 0) stairCooldown--;

 player.x = Math.max(10, Math.min(player.x, 790-player.w));
 player.y = Math.max(10, Math.min(player.y, 590-player.h));

 for(const w of room.walls){
   if(player.x+player.w > w.x && player.x < w.x+w.w &&
      player.y+player.h > w.y && player.y < w.y+w.h){
     player.x = prevX;
     player.y = prevY;
   }
 }
}

function updateHUD(){
 const room = ROOMS[currentRoom];
 roomInfo.textContent = "Room: " + currentRoom;
 floorInfo.textContent = "Floor: " + room.floor;
 scoreInfo.textContent = "Score: " + score;
 weaponsInfo.textContent = "Weapons: " + collected.length;
 livesInfo.textContent = "Lives: " + lives;
}

function draw(){
 if(gameOver) return;
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle="#FFC8C8";
 ctx.fillRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle="#3264FF";
 ctx.fillRect(player.x,player.y,player.w,player.h);
 moveGuards();
 requestAnimationFrame(draw);
}

draw();
updateHUD();

/* ---------- UI BUTTONS ---------- */
document.getElementById("mapButton").onclick = () => {
 showMap = !showMap;
 mapCanvas.style.display = showMap ? "block" : "none";
};

document.getElementById("instructionButton").onclick = () => {
 instructions.style.display =
  instructions.style.display === "none" ? "block" : "none";
};
</script>

<!-- HOLDABLE CONTROLS -->
<div id="buttonControls">
  <div>
    <button onmousedown="startMove('up')" onmouseup="stopMove()"
            ontouchstart="startMove('up')" ontouchend="stopMove()">⬆️</button>
  </div>
  <div>
    <button onmousedown="startMove('left')" onmouseup="stopMove()"
            ontouchstart="startMove('left')" ontouchend="stopMove()">⬅️</button>
    <button onmousedown="startMove('down')" onmouseup="stopMove()"
            ontouchstart="startMove('down')" ontouchend="stopMove()">⬇️</button>
    <button onmousedown="startMove('right')" onmouseup="stopMove()"
            ontouchstart="startMove('right')" ontouchend="stopMove()">➡️</button>
  </div>
</div>

</body>
</html>
