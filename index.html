<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Clue: The Floors of Mystery</title>
    <style>
        body { text-align:center; font-family:sans-serif; position: relative; }

        #hud { margin-bottom:10px; font-size:16px; }
        #hud p { margin:2px; }

        #gameContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }


        canvas {
            background-color:#b4b4b4;
            display:block;
            margin:5px;
            border:1px solid black;
        }

        #cheatDisplay { font-size:16px; margin-top:10px; }
        #mapButton, #instructionButton { margin:10px; padding:5px 10px; font-size:16px; }

        #instructions {
            display:none;
            position:absolute;
            left:10px;
            top:100px;
            background-color:#f0f0f0;
            padding:10px;
            border:1px solid #000;
            text-align:left;
        }

        #buttonControls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display:none;
        }

        #buttonControls button {
            font-size: 40px;
            padding: 20px 25px;
            margin: 5px;
            border-radius: 8px;
        }

        /* Cheat input styling */
        #cheatContainer {
            margin-top: 10px;
        }

        #cheatInput { font-size:16px; padding:4px; width:150px; }
        #cheatButton { font-size:16px; padding:4px 8px; }

        /* Mobile-specific layout */
        @media (max-width: 768px) {
            #gameContainer {
                flex-direction: column; /* Stack game and map vertically on mobile */
                align-items: center;
            }
            #mapCanvas {
                display:block;
                margin-top:10px;
            }
        }

        /* Desktop-specific layout */
        @media (min-width: 769px) {
            #gameContainer {
                flex-direction: row; /* Arrange game and map side-by-side on desktop */
                justify-content: center;
            }
            #mapCanvas {
                display:block;
                margin-left: 10px; /* Space between game and map */
            }
        }
    </style>
</head>
<body>
<h2>Clue: The Floors of Mystery</h2>

<div id="hud">
    <p id="roomInfo">Room: BALLROOM</p>
    <p id="scoreInfo">Score: 0</p>
    <p id="weaponsInfo">Weapons: 0/6</p>
    <p id="livesInfo">Lives: 3</p>
</div>

<div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <canvas id="mapCanvas" width="0" height="0" style="display:none;"></canvas>
</div>

<div>
    <button id="mapButton">Toggle Map</button>
    <button id="instructionButton">Toggle Instructions</button>
</div>

<div id="cheatContainer">
    <input type="text" id="cheatInput" placeholder="Type Here">
    <button id="cheatButton">Activate</button>
    <p id="cheatDisplay"></p>
</div>

<p id="instructions">
    1. Use the arrow keys to travel between rooms. <br>
    2. Navigate the mansion to collect all six weapons. <br>
    3. Avoid the guards! Each guard hit costs a life. <br>
    4. You have 3 lives. Lose all, and it's Game Over. <br>
    5. Check the map to view your location.
</p>

<div id="buttonControls">
    <button data-dir="up">▲</button>
    <br>
    <button data-dir="left">◀</button>
    <button data-dir="down">▼</button>
    <button data-dir="right">▶</button>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const mapCanvas = document.getElementById('mapCanvas');
    const mapCtx = mapCanvas.getContext('2d');

    const roomInfo = document.getElementById("roomInfo");
    const scoreInfo = document.getElementById("scoreInfo");
    const weaponsInfo = document.getElementById("weaponsInfo");
    const livesInfo = document.getElementById("livesInfo");
    const cheatDisplay = document.getElementById("cheatDisplay");

    let player = {x:50,y:50,w:25,h:25,speed:3};
    let score = 0;
    let collected = [];
    let currentRoom = "BALLROOM";
    let showMap = false;
    let lives = 3;
    let gameOver = false;
    let guards = [
        {x:200,y:150,w:25,h:25,speed:2,dx:1,dy:0,room:"BALLROOM"},
        {x:500,y:400,w:25,h:25,speed:1.5,dx:0,dy:1,room:"DINING ROOM"}
    ];
    let requiredWeapons = 6;
    let deathPenalty = 1;

    // --- Temporary active cheat trackers ---
    let activeGuards = [];
    let zkyekoTimeout = null;
    let nkuglaTimeout = null;

    const cheatCodes = {
        "ANZPYL": () => {
            let added = [];
            for (let i=0;i<15;i++){
                const g = {
                    x: Math.random()*700+50,
                    y: Math.random()*500+50,
                    w:25,h:25,
                    speed:1+Math.random()*2,
                    dx:Math.floor(Math.random()*3)-1,
                    dy:Math.floor(Math.random()*3)-1,
                    room: currentRoom
                };
                guards.push(g);
                added.push(g);
            }
            activeGuards.push(...added);
            // remove after 15s
            setTimeout(()=>{
                for(const g of added){
                    const idx=guards.indexOf(g);
                    if(idx>=0) guards.splice(idx,1);
                }
            },15000);
        },
        "ZKYEKO": () => {
            // Cancel previous timeout if active
            if(zkyekoTimeout) clearTimeout(zkyekoTimeout);
            let allRooms = Object.keys(ROOMS);
            let changed=0;
            for(const r of allRooms){
                for(const d of ROOMS[r].doors){
                    if(changed>=3) break;
                    let wrong;
                    do { wrong = allRooms[Math.floor(Math.random()*allRooms.length)]; }
                    while(wrong===d.to);
                    d._original = d.to; // store original
                    d.to = wrong;
                    changed++;
                }
            }
            zkyekoTimeout = setTimeout(()=>{
                for(const r of allRooms){
                    for(const d of ROOMS[r].doors){
                        if(d._original) d.to = d._original;
                    }
                }
                cheatDisplay.textContent = "ZKYEKO effect ended";
                zkyekoTimeout = null;
            },15000);
        },
        "LNVNLS": () => { lives+=8; updateHUD(); },
        "VKOGPZ": () => {
            let allRooms = Object.keys(ROOMS);
            for(let i=0;i<9;i++){
                const from = ROOMS[allRooms[Math.floor(Math.random()*allRooms.length)]];
                const to = allRooms[Math.floor(Math.random()*allRooms.length)];
                from.doors.push({x:(Math.random()<0.5?0:1)*800, y:Math.random()*500+20, w:20, h:80, to});
            }
        },
        "NKUGLA": () => {
            deathPenalty = 4;
            if(nkuglaTimeout) clearTimeout(nkuglaTimeout);
            nkuglaTimeout = setTimeout(()=>{
                deathPenalty = 1;
                cheatDisplay.textContent = "NKUGLA effect ended";
                nkuglaTimeout=null;
            },15000);
        }
    };

    // ---------- Cheat input ----------
    const cheatInput = document.getElementById('cheatInput');
    const cheatButton = document.getElementById('cheatButton');

    function activateCheat(code){
        code = code.toUpperCase();
        if(cheatCodes[code]){
            cheatCodes[code]();
            cheatInput.value = "";
            cheatDisplay.textContent = "Cheat activated: " + code;
            updateHUD();
        } else {
            cheatDisplay.textContent = "Invalid cheat: " + code;
        }
    }
    cheatButton.addEventListener('click', ()=>activateCheat(cheatInput.value));
    cheatInput.addEventListener('keydown', e=>{ if(e.key==="Enter") activateCheat(cheatInput.value); });

    // ---------- Rooms ----------
    const ROOMS = {
        "KITCHEN":{
            floor:1,
            weapons:[
                {name:"Knife",x:50,y:50,w:20,h:20}
            ],
            walls:[
                {x:0,y:0,w:800,h:10},
                {x:0,y:0,w:10,h:600},
                {x:790,y:0,w:10,h:600},
                {x:0,y:590,w:800,h:10}
            ],
            doors:[
                {x:789,y:250,w:11,h:100,to:"BALLROOM"}
            ],
            stairs:null
        },
        "BALLROOM":{
            floor:1,
            weapons:[
                {name:"Candlestick",x:300,y:100,w:20,h:20}
            ],
            walls:[
                {x:0,y:0,w:800,h:10},
                {x:0,y:0,w:10,h:600},
                {x:790,y:0,w:10,h:600},
                {x:0,y:590,w:800,h:10}
            ],
            doors:[
                {x:0,y:250,w:11,h:100,to:"KITCHEN"},
                {x:350,y:589,w:100,h:11,to:"DINING ROOM"},
                {x:789,y:100,w:11,h:100,to:"HALL"}
            ],
            stairs:null
        },
        "HALL":{
            floor:1,
            weapons:[
                {name:"Pistol",x:200,y:100,w:20,h:20}
            ],
            walls:[
                {x:0,y:0,w:800,h:10},
                {x:0,y:0,w:10,h:600},
                {x:790,y:0,w:10,h:600},
                {x:0,y:590,w:800,h:10}
            ],
            doors:[
                {x:0,y:100,w:11,h:100,to:"BALLROOM"}
            ],
            stairs:null
        },
        "DINING ROOM":{
            floor:1,
            weapons:[
                {name:"Wrench",x:100,y:50,w:20,h:20}
            ],
            walls:[
                {x:0,y:0,w:800,h:10},
                {x:0,y:0,w:10,h:600},
                {x:790,y:0,w:10,h:600},
                {x:0,y:590,w:800,h:10},
                {x:740,y:530,w:50,h:10}
            ],
            doors:[
                {x:350,y:0,w:100,h:11,to:"BALLROOM"}
            ],
            stairs:{x:740,y:540,w:50,h:50,to:"ART ROOM"},
            objects:[
                {type:"circle",x:400,y:300,radius:50,color:"#FFFF99"}
            ]
        },
        "ART ROOM":{
            floor:2,
            weapons:[
                {name:"Lead Pipe",x:600,y:100,w:20,h:20}
            ],
            walls:[
                {x:0,y:0,w:800,h:10},
                {x:0,y:0,w:10,h:600},
                {x:790,y:0,w:10,h:600},
                {x:0,y:590,w:800,h:10},
                {x:10,y:530,w:50,h:10}
            ],
            doors:[
                {x:0,y:250,w:11,h:100,to:"CONSERVATORY"}
            ],
            stairs:{x:10,y:540,w:50,h:50,to:"DINING ROOM"},
            objects:[
                {type:"rect",x:100,y:100,w:80,h:50,color:"#FF0000"},
                {type:"rect",x:600,y:100,w:80,h:50,color:"#00FF00"},
                {type:"rect",x:100,y:400,w:80,h:50,color:"#0000FF"},
                {type:"rect",x:600,y:400,w:80,h:50,color:"#FFFF00"}
            ]
        },
        "CONSERVATORY":{
            floor:2,
            weapons:[
                {name:"Rope",x:600,y:50,w:20,h:20}
            ],
            walls:[
                {x:0,y:0,w:800,h:10},
                {x:0,y:0,w:10,h:600},
                {x:790,y:0,w:10,h:600},
                {x:0,y:590,w:800,h:10}
            ],
            doors:[
                {x:789,y:250,w:11,h:100,to:"ART ROOM"}
            ],
            stairs:null,
            objects:[
                {type:"circle",x:100,y:100,radius:20,color:"#228B22"},
                {type:"circle",x:300,y:150,radius:20,color:"#228B22"},
                {type:"circle",x:500,y:100,radius:20,color:"#228B22"},
                {type:"circle",x:200,y:300,radius:20,color:"#228B22"},
                {type:"circle",x:600,y:200,radius:20,color:"#228B22"}
            ]
        }
    };

    // ---------- HUD ----------
    function updateHUD(){
        roomInfo.textContent = "Room: "+currentRoom;
        scoreInfo.textContent = "Score: "+score;
        weaponsInfo.textContent = "Weapons: "+collected.length+"/"+requiredWeapons;
        livesInfo.textContent = "Lives: "+lives;
    }

    // ---------- Movement ----------
    const keysPressed = {};
    document.addEventListener('keydown', e=>{ keysPressed[e.key]=true; });
    document.addEventListener('keyup', e=>{ keysPressed[e.key]=false; });

    function moveFromButton(dir){
        if(gameOver) return;
        const prevX=player.x, prevY=player.y;
        if(dir==="left") player.x-=player.speed;
        if(dir==="right") player.x+=player.speed;
        if(dir==="up") player.y-=player.speed;
        if(dir==="down") player.y+=player.speed;
        handleCollisions(prevX,prevY);
        updateHUD();
    }

    function handleKeyboardMovement(){
        if(keysPressed["ArrowLeft"]) moveFromButton("left");
        if(keysPressed["ArrowRight"]) moveFromButton("right");
        if(keysPressed["ArrowUp"]) moveFromButton("up");
        if(keysPressed["ArrowDown"]) moveFromButton("down");
        requestAnimationFrame(handleKeyboardMovement);
    }
    handleKeyboardMovement();

    // ---------- Mobile buttons ----------
    function isMobileDevice(){ return /Android|iPhone|iPad|iPod|Mobile|Tablet/i.test(navigator.userAgent); }
    if(isMobileDevice()){
        const buttonControls = document.getElementById("buttonControls");
        buttonControls.style.display="block";
        const arrowButtons = buttonControls.querySelectorAll("button");
        const activeDirs = {};
        arrowButtons.forEach(btn=>{
            const dir = btn.getAttribute("data-dir");
            btn.addEventListener("touchstart", e=>{ e.preventDefault(); activeDirs[dir]=true; });
            btn.addEventListener("touchend", e=>{ e.preventDefault(); activeDirs[dir]=false; });
        });
        function handleTouchMovement(){
            for(const dir in activeDirs) if(activeDirs[dir]) moveFromButton(dir);
            requestAnimationFrame(handleTouchMovement);
        }
        handleTouchMovement();
    }

    // ---------- Collisions & drawing ----------
    let stairCooldown=0;
    let doorCooldown=0;

    function handleCollisions(prevX, prevY){
        const room = ROOMS[currentRoom];
        // Stay in bounds
        player.x = Math.max(10, Math.min(player.x,790-player.w));
        player.y = Math.max(10, Math.min(player.y,590-player.h));
        // Walls
        for(const w of room.walls){
            if(player.x+player.w>w.x && player.x<w.x+w.w && player.y+player.h>w.y && player.y<w.y+w.h){
                player.x=prevX; player.y=prevY;
            }
        }
        // Weapons
        for(let i=room.weapons.length-1;i>=0;i--){
            const w=room.weapons[i];
            if(player.x+player.w>w.x && player.x<w.x+w.w && player.y+player.h>w.y && player.y<w.y+w.h){
                collected.push(w.name);
                room.weapons.splice(i,1);
                score+=100;
                if(collected.length >= requiredWeapons){
                    gameOver = true;
                    alert("Congratulations! You collected all weapons and won the game!");
                }
            }
        }
        // Doors
        if(doorCooldown>0) doorCooldown--;
        else{
            for(const d of room.doors){
                if(player.x+player.w>d.x && player.x<d.x+d.w && player.y+player.h>d.y && player.y<d.y+d.h){
                    currentRoom=d.to;
                    if (player.x<30 ||player.x>750){
                        player.x=800-player.x;
                    }
                    else{
                        player.y=600-player.y;
                    }
                    doorCooldown=10;
                    break;
                }
            }
        }
        // Stairs
        if(stairCooldown>0) stairCooldown--;
        else if(room.stairs && player.x+player.w>room.stairs.x && player.x<room.stairs.x+room.stairs.w && player.y+player.h>room.stairs.y && player.y<room.stairs.y+room.stairs.h){
            currentRoom=room.stairs.to;
            stairCooldown=10;
            player.x=780-player.x;
        }
    }

    function moveGuards(){
        for(const g of guards){
            if(g.room!==currentRoom) continue;
            g.x+=g.dx*g.speed; g.y+=g.dy*g.speed;
            g.x=Math.max(10,Math.min(g.x,790-g.w)); g.y=Math.max(10,Math.min(g.y,590-g.h));
            if(Math.random()<0.01){ g.dx=Math.floor(Math.random()*3)-1; g.dy=Math.floor(Math.random()*3)-1; }
            if(player.x<g.x+g.w && player.x+player.w>g.x && player.y<g.y+g.h && player.y+player.h>g.y){
                lives-=deathPenalty; updateHUD();
                if(lives<=0){ gameOver=true; alert("Game Over!"); }
                else{ player.x=50; player.y=50; }
            }
        }
    }

    function draw(){
            if(gameOver) return;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            const room=ROOMS[currentRoom];
            ctx.fillStyle="#FFC8C8"; ctx.fillRect(0,0,canvas.width,canvas.height); // light yellow
            ctx.fillStyle="#000"; for(const w of room.walls) ctx.fillRect(w.x,w.y,w.w,w.h);
            ctx.fillStyle="#FFD700"; for(const d of room.doors) ctx.fillRect(d.x,d.y,d.w,d.h);
            if(room.stairs){ ctx.fillStyle="#969696"; ctx.fillRect(room.stairs.x,room.stairs.y,room.stairs.w,room.stairs.h); }
            if(room.objects){ for(const obj of room.objects){ if(obj.type==="circle"){ ctx.fillStyle=obj.color; ctx.beginPath(); ctx.arc(obj.x,obj.y,obj.radius,0,2*Math.PI); ctx.fill(); } else if(obj.type==="rect"){ ctx.fillStyle=obj.color; ctx.fillRect(obj.x,obj.y,obj.w,obj.h); } } }
            ctx.fillStyle="#008000"; for(const w of room.weapons) ctx.fillRect(w.x,w.y,w.w,w.h); // green
            ctx.fillStyle="#3264FF"; ctx.fillRect(player.x,player.y,player.w,player.h);
            for(const g of guards){ if(g.room===currentRoom){ ctx.fillStyle="red"; ctx.fillRect(g.x,g.y,g.w,g.h); } }
            requestAnimationFrame(draw);
        }

        function drawMap() {

            const allRooms = Object.keys(ROOMS);
            const isMobile = isMobileDevice();

            // Handle mobile layout (rooms side by side)
            if (isMobile) {
                mapCtx.clearRect(0, 0, 600, 115);

                // Draw each room horizontally (side by side)
                allRooms.forEach((r) => {
                    mapCtx.fillStyle = "#FFFFC8";
                    mapCtx.fillRect(offsetX, 20, 75, 50); // Room box
                    mapCtx.fillStyle = "black";
                    mapCtx.fillText(r, offsetX + 5, 50); // Room name
                    offsetX += roomWidth + 20;  // Increase offset for next room (horizontal layout)
                })
            } else {
                mapCtx.clearRect(0, 0, 115, 440);
                // Handle desktop layout (rooms stacked vertically)
                let offsetY = 20; // Starting position for Y on desktop
                for (const r of allRooms) {
                    mapCtx.fillStyle = "#FFFFC8";
                    mapCtx.fillRect(20, offsetY, 75, 50); // Room box
                    mapCtx.fillStyle = "black";
                    mapCtx.fillText(r, 25, offsetY + 30); // Room name
                    offsetY += 70; // Increase the vertical spacing
                }
            }

            if (showMap) requestAnimationFrame(drawMap);
        }



    function gameLoop(){
        moveGuards();
        handleCollisions(player.x,player.y);
        requestAnimationFrame(gameLoop);
    }
    draw();
    gameLoop();

    document.getElementById("mapButton").addEventListener("click", () => {
        showMap = !showMap;
        mapCanvas.style.display = showMap ? "block" : "none"; // Show/hide map

        // Dynamically change the layout when map is toggled
        const container = document.getElementById("gameContainer");

        // Mobile: stack vertically, Desktop: side by side
        if (showMap) {
            if (isMobileDevice()) {
                container.style.flexDirection = "column";  // Stack vertically on mobile
            } else {
                container.style.flexDirection = "row";     // Side by side on desktop
            }
            drawMap(); // Optional: Redraw the map when toggled
        } else {
            // Reset to desktop layout (row) when hiding the map
            if (!isMobileDevice()) {
                container.style.flexDirection = "row";
            }
        }
    });


    document.getElementById("instructionButton").addEventListener("click", ()=>{
        const instr=document.getElementById("instructions");
        instr.style.display=(instr.style.display==="none")?"block":"none";
    });

    updateHUD();
</script>
</body>
</html>
