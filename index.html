<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clue: The Floors of Mystery</title>
<style>
body { text-align:center; font-family:sans-serif; position: relative; }
#hud { margin-bottom:10px; font-size:16px; }
#hud p { margin:2px; }
#gameContainer { display:flex; justify-content:center; align-items:flex-start; }
canvas { background-color:#b4b4b4; display:block; margin:5px; border:1px solid black; }
#cheatDisplay { font-size:16px; margin-top:10px; }
#mapButton, #instructionButton { margin:10px; padding:5px 10px; font-size:16px; }
#instructions {
 display:none;
 position:absolute;
 left:10px;
 top:100px;
 background-color:#f0f0f0;
 padding:10px;
 border:1px solid #000;
 text-align:left;
}
#buttonControls {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  display:none;
}

#buttonControls button {
  font-size: 40px;
  padding: 20px 25px;
  margin: 5px;
  border-radius: 8px;
}

/* Cheat input styling */
#cheatContainer {
  margin-top: 10px;
}
#cheatInput { font-size:16px; padding:4px; width:150px; }
#cheatButton { font-size:16px; padding:4px 8px; }
</style>
</head>
<body>
<h2>Clue: The Floors of Mystery</h2>

<div id="hud">
 <p id="roomInfo">Room: BALLROOM</p>
 <p id="scoreInfo">Score: 0</p>
 <p id="weaponsInfo">Weapons: 0/6</p>
 <p id="livesInfo">Lives: 3</p>
</div>

<div id="gameContainer">
 <canvas id="gameCanvas" width="800" height="600"></canvas>
 <canvas id="mapCanvas" width="300" height="600" style="display:none;"></canvas>
</div>

<div>
 <button id="mapButton">Toggle Map</button>
 <button id="instructionButton">Toggle Instructions</button>
</div>

<div id="cheatContainer">
  <input type="text" id="cheatInput" placeholder="Type Here">
  <button id="cheatButton">Activate</button>
  <p id="cheatDisplay"></p>
</div>

<p id="instructions">
1. Use the arrow keys to travel between rooms. <br>
2. Navigate the mansion to collect all six weapons. <br>
3. Avoid the guards! Each guard hit costs a life. <br>
4. You have 3 lives. Lose all, and it's Game Over. <br>
5. Check the map to view your location.
</p>

<div id="buttonControls">
  <button data-dir="up">▲</button><br>
  <button data-dir="left">◀</button>
  <button data-dir="down">▼</button>
  <button data-dir="right">▶</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mapCanvas = document.getElementById('mapCanvas');
const mapCtx = mapCanvas.getContext('2d');
let vkyekoCooldown = 0;

const roomInfo = document.getElementById("roomInfo");
const scoreInfo = document.getElementById("scoreInfo");
const weaponsInfo = document.getElementById("weaponsInfo");
const livesInfo = document.getElementById("livesInfo");

const player = {x:50,y:50,w:25,h:25,speed:3};
 
let score = 0;
let collected = [];
let currentRoom = "BALLROOM";
let showMap = false;
let lives = 3;
let gameOver = false;

let guards = [
 {x:200,y:150,w:25,h:25,speed:2,dx:1,dy:0,room:"BALLROOM"},
 {x:500,y:400,w:25,h:25,speed:1.5,dx:0,dy:1,room:"DINING ROOM"}
];

let requiredWeapons = 6;
let deathPenalty = 1;

const cheatCodes = {
  "INZPYL": () => {
    for (let i = 0; i < 15; i++) {
      guards.push({
        x: Math.random() * 700 + 50,
        y: Math.random() * 500 + 50,
        w: 25,
        h: 25,
        speed: 1 + Math.random() * 2,
        dx: Math.floor(Math.random() * 3) - 1,
        dy: Math.floor(Math.random() * 3) - 1,
        room: currentRoom
      });
    }
  },
  "ESPTVX": () => {
    requiredWeapons += 18; spawnExtraWeapons(18);
  },
  "VKYEKO": () => {
    if(vkyekoCooldown>0){alert("VKYEKO on cooldown!");return;}
    vkyekoCooldown = 300;
    let allRooms = Object.keys(ROOMS);
    let changed=0;
    for(const r of allRooms){
      for(const d of ROOMS[r].doors){
        if(changed>=3) return;
        let wrong;
        do { wrong = allRooms[Math.floor(Math.random()*allRooms.length)]; }
        while(wrong===d.to);
        d.to = wrong;
        changed++;
      }
    }
  },
  "LNVNLS": () => { lives+=8; updateHUD(); },
  "VKOGPZ": () => {
    let allRooms = Object.keys(ROOMS);
    for(let i=0;i<9;i++){
      const from = ROOMS[allRooms[Math.floor(Math.random()*allRooms.length)]];
      const to = allRooms[Math.floor(Math.random()*allRooms.length)];
      from.doors.push({x:(Math.random()<0.5?0:1)*800, y:Math.random()*500+20, w:20, h:80, to});
    }
  },
  "NKUGLA": () => { deathPenalty=4; }
};

// ---------- CHEAT INPUT ----------
const cheatInput = document.getElementById('cheatInput');
const cheatButton = document.getElementById('cheatButton');

function activateCheat(code){
  code = code.toUpperCase();
  if(cheatCodes[code]){
    cheatCodes[code]();
    cheatInput.value = "";
    cheatDisplay.textContent = "Cheat activated: " + code;
    updateHUD();
  } else {
    cheatDisplay.textContent = "Invalid cheat: " + code;
  }
}
cheatButton.addEventListener('click', ()=>activateCheat(cheatInput.value));
cheatInput.addEventListener('keydown', e=>{ if(e.key==="Enter") activateCheat(cheatInput.value); });

// ---------- ROOMS ----------
const ROOMS = {
  "KITCHEN":{floor:1,weapons:[{name:"Knife",x:50,y:50,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:780,y:250,w:11,h:100,to:"BALLROOM"}],stairs:null},
  "BALLROOM":{floor:1,weapons:[{name:"Candlestick",x:300,y:100,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:0,y:250,w:11,h:100,to:"KITCHEN"},{x:350,y:580,w:100,h:11,to:"DINING ROOM"},{x:780,y:100,w:11,h:100,to:"HALL"}],stairs:null},
  "HALL":{floor:1,weapons:[{name:"Pistol",x:200,y:100,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:0,y:100,w:11,h:100,to:"BALLROOM"}],stairs:null},
  "DINING ROOM":{floor:1,weapons:[{name:"Wrench",x:100,y:50,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:350,y:0,w:100,h:11,to:"BALLROOM"}],stairs:{x:740,y:540,w:50,h:50,to:"ART ROOM"},objects:[{type:"circle",x:400,y:300,radius:50,color:"#FFFF99"}]},
  "ART ROOM":{floor:2,weapons:[{name:"Lead Pipe",x:600,y:100,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:0,y:250,w:11,h:100,to:"CONSERVATORY"}],stairs:{x:10,y:540,w:50,h:50,to:"DINING ROOM"},objects:[{type:"rect",x:100,y:100,w:80,h:50,color:"#FF0000"},{type:"rect",x:600,y:100,w:80,h:50,color:"#00FF00"},{type:"rect",x:100,y:400,w:80,h:50,color:"#0000FF"},{type:"rect",x:600,y:400,w:80,h:50,color:"#FFFF00"}]},
  "CONSERVATORY":{floor:2,weapons:[{name:"Rope",x:600,y:50,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:780,y:250,w:11,h:100,to:"ART ROOM"}],stairs:null,objects:[{type:"circle",x:100,y:100,radius:20,color:"#228B22"},{type:"circle",x:300,y:150,radius:20,color:"#228B22"},{type:"circle",x:500,y:100,radius:20,color:"#228B22"},{type:"circle",x:200,y:300,radius:20,color:"#228B22"},{type:"circle",x:600,y:200,radius:20,color:"#228B22"}]}
};

// ---------- MOVEMENT & COLLISIONS ----------
function moveFromButton(direction){
  if(gameOver) return;
  const prevX=player.x, prevY=player.y;
  if(direction==="left") player.x-=player.speed;
  if(direction==="right") player.x+=player.speed;
  if(direction==="up") player.y-=player.speed;
  if(direction==="down") player.y+=player.speed;
  handleCollisions(prevX,prevY);
  updateHUD();
}

const keysPressed = {};
document.addEventListener('keydown', e=>{ if(gameOver) return; keysPressed[e.key]=true; });
document.addEventListener('keyup', e=>{ keysPressed[e.key]=false; });

function handleKeyboardMovement(){
  if(keysPressed["ArrowLeft"]) moveFromButton("left");
  if(keysPressed["ArrowRight"]) moveFromButton("right");
  if(keysPressed["ArrowUp"]) moveFromButton("up");
  if(keysPressed["ArrowDown"]) moveFromButton("down");
  requestAnimationFrame(handleKeyboardMovement);
}
handleKeyboardMovement();

// ---------- MOBILE TOUCH ARROWS ----------
function isMobileDevice(){ return /Android|iPhone|iPad|iPod|Mobile|Tablet/i.test(navigator.userAgent); }
if(isMobileDevice()){
  const buttonControls = document.getElementById("buttonControls");
  buttonControls.style.display="block";
  const arrowButtons = buttonControls.querySelectorAll("button");
  const activeDirs = {};
  arrowButtons.forEach(btn=>{
    const dir = btn.getAttribute("data-dir");
    btn.addEventListener("touchstart", e=>{ e.preventDefault(); activeDirs[dir]=true; });
    btn.addEventListener("touchend", e=>{ e.preventDefault(); activeDirs[dir]=false; });
  });
  function handleTouchMovement(){
    for(const dir in activeDirs) if(activeDirs[dir]) moveFromButton(dir);
    requestAnimationFrame(handleTouchMovement);
  }
  handleTouchMovement();
}

// ---------- UPDATE & DRAW ----------
function updateHUD(){
 const room = ROOMS[currentRoom];
 roomInfo.textContent = "Room: "+currentRoom;
 scoreInfo.textContent = "Score: "+score;
 weaponsInfo.textContent = "Weapons: "+collected.length+"/"+requiredWeapons;
 livesInfo.textContent = "Lives: "+lives;
}

function moveGuards(){
 for(const g of guards){
   if(g.room!==currentRoom) continue;
   g.x+=g.dx*g.speed; g.y+=g.dy*g.speed;
   g.x=Math.max(10,Math.min(g.x,790-g.w)); g.y=Math.max(10,Math.min(g.y,590-g.h));
   if(Math.random()<0.01){ g.dx=Math.floor(Math.random()*3)-1; g.dy=Math.floor(Math.random()*3)-1; }
   if(player.x<g.x+g.w && player.x+player.w>g.x && player.y<g.y+g.h && player.y+player.h>g.y){
     lives-=deathPenalty; updateHUD();
     if(lives<=0){ gameOver=true; alert("Game Over!"); }
     else{ player.x=50; player.y=50; }
   }
 }
}

let stairCooldown = 0; // cooldown for stairs
let doorCooldown = 0;  // cooldown for doors

function handleCollisions(prevX, prevY) {
    const room = ROOMS[currentRoom];

    // --- Keep player inside room bounds ---
    player.x = Math.max(10, Math.min(player.x, 790 - player.w));
    player.y = Math.max(10, Math.min(player.y, 590 - player.h));

    // --- Walls collision ---
    for (const w of room.walls) {
        if (
            player.x + player.w > w.x &&
            player.x < w.x + w.w &&
            player.y + player.h > w.y &&
            player.y < w.y + w.h
        ) {
            player.x = prevX;
            player.y = prevY;
        }
    }

    // --- Weapons collection ---
    for (let i = room.weapons.length - 1; i >= 0; i--) {
        const w = room.weapons[i];
        if (
            player.x + player.w > w.x &&
            player.x < w.x + w.w &&
            player.y + player.h > w.y &&
            player.y < w.y + w.h
        ) {
            collected.push(w.name);
            room.weapons.splice(i, 1);
            score += 100;
        }
    }

    // --- Doors ---
    if (doorCooldown > 0) doorCooldown--;
    else {
        for (const d of room.doors) {
            if (
                player.x + player.w > d.x &&
                player.x < d.x + d.w &&
                player.y + player.h > d.y &&
                player.y < d.y + d.h
            ) {
                // Change room
                currentRoom = d.to;

                // Place player just outside the door in the new room
                const exitRoom = ROOMS[currentRoom];
                if (d.x === 0) player.x = exitRoom.doors.find(dr => dr.to === room ? room : d.to).x + exitRoom.doors[0].w + 1;
                else if (d.x + d.w >= 790) player.x = exitRoom.doors[0].x - player.w - 1;

                if (d.y === 0) player.y = exitRoom.doors[0].y + exitRoom.doors[0].h + 1;
                else if (d.y + d.h >= 590) player.y = exitRoom.doors[0].y - player.h - 1;

                doorCooldown = 10; // short cooldown
                break; // only one door per frame
            }
        }
    }

    // --- Stairs ---
    if (stairCooldown > 0) stairCooldown--;
    else if (room.stairs) {
        const s = room.stairs;
        if (
            player.x + player.w > s.x &&
            player.x < s.x + s.w &&
            player.y + player.h > s.y &&
            player.y < s.y + s.h
        ) {
            stairCooldown = 10;
            const targetRoom = s.to;
            const fromFloor = room.floor;
            const toFloor = ROOMS[targetRoom].floor;
            currentRoom = targetRoom;

            // Place player just inside the target room
            if (toFloor > fromFloor) {
                player.x = 60;
                player.y = 50;
            } else {
                player.x = 60;
                player.y = 500;
            }
        }
    }
}

function draw(){
 if(gameOver) return;
 ctx.clearRect(0,0,canvas.width,canvas.height);
 const room=ROOMS[currentRoom];
 ctx.fillStyle="#FFC8C8"; ctx.fillRect(0,0,canvas.width,canvas.height);
 ctx.fillStyle="#000"; for(const w of room.walls) ctx.fillRect(w.x,w.y,w.w,w.h);
 ctx.fillStyle="#FFD700"; for(const d of room.doors) ctx.fillRect(d.x,d.y,d.w,d.h);
 if(room.stairs){ ctx.fillStyle="#969696"; ctx.fillRect(room.stairs.x,room.stairs.y,room.stairs.w,room.stairs.h); ctx.fillStyle="black"; ctx.fillText("STAIRS",room.stairs.x+5,room.stairs.y+30); }
 if(room.objects){ for(const obj of room.objects){ if(obj.type==="circle"){ ctx.fillStyle=obj.color||"gray"; ctx.beginPath(); ctx.arc(obj.x,obj.y,obj.radius,0,Math.PI*2); ctx.fill(); } else if(obj.type==="rect"){ ctx.fillStyle=obj.color||"gray"; ctx.fillRect(obj.x,obj.y,obj.w,obj.h); } } }
 ctx.fillStyle="#8B0000"; for(const w of room.weapons) ctx.fillRect(w.x,w.y,w.w,w.h);
 ctx.fillStyle="#3264FF"; ctx.fillRect(player.x,player.y,player.w,player.h);
 moveGuards();
 for(const g of guards){ if(g.room!==currentRoom) continue; ctx.fillStyle="red"; ctx.fillRect(g.x,g.y,g.w,g.h); }
 if(collected.length>=requiredWeapons){ ctx.fillStyle="white"; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle="black"; ctx.font="30px sans-serif"; ctx.fillText("YOU WIN!",300,250); ctx.fillText(`Score: ${score}`,300,300); return; }
 requestAnimationFrame(draw);
}
draw();

// ---------- MAP ----------
document.getElementById("mapButton").addEventListener('click', ()=>{
 showMap=!showMap;
 mapCanvas.style.display=showMap?"block":"none";
});

document.getElementById("instructionButton").addEventListener('click', ()=>{
 const instr=document.getElementById("instructions");
 instr.style.display=(instr.style.display==="none")?"block":"none";
});

function spawnExtraWeapons(n){
 const rooms=Object.values(ROOMS);
 for(let i=0;i<n;i++){
   const room=rooms[Math.floor(Math.random()*rooms.length)];
   room.weapons.push({name:"Bonus"+i, x:Math.random()*700+50, y:Math.random()*500+50, w:20, h:20});
 }
}
</script>
</body>
</html>
