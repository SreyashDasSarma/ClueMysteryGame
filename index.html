<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clue: The Floors of Mystery</title>
<style>
body { text-align:center; font-family:sans-serif; position: relative; }
#hud { margin-bottom:10px; font-size:16px; }
#hud p { margin:2px; }
#gameContainer { display:flex; justify-content:center; align-items:flex-start; }
canvas { background-color:#b4b4b4; display:block; margin:5px; border:1px solid black; }
#cheatDisplay { font-size:16px; margin-top:10px; }
#mapButton, #instructionButton { margin:10px; padding:5px 10px; font-size:16px; }
#instructions {
 display:none;
 position:absolute;
 left:10px;
 top:100px;
 background-color:#f0f0f0;
 padding:10px;
 border:1px solid #000;
 text-align:left;
}
#buttonControls {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  display:none;
}
#buttonControls button {
  font-size: 40px;
  padding: 20px 25px;
  margin: 5px;
  border-radius: 8px;
}
/* Cheat input styling */
#cheatContainer {
  margin-top: 10px;
}
#cheatInput { font-size:16px; padding:4px; width:150px; }
#cheatButton { font-size:16px; padding:4px 8px; }
</style>
</head>
<body>
<h2>Clue: The Floors of Mystery</h2>

<div id="hud">
 <p id="roomInfo">Room: BALLROOM</p>
 <p id="scoreInfo">Score: 0</p>
 <p id="weaponsInfo">Weapons: 0/6</p>
 <p id="livesInfo">Lives: 3</p>
</div>

<div id="gameContainer">
 <canvas id="gameCanvas" width="800" height="600"></canvas>
 <canvas id="mapCanvas" width="300" height="600" style="display:none;"></canvas>
</div>

<div>
 <button id="mapButton">Toggle Map</button>
 <button id="instructionButton">Toggle Instructions</button>
</div>

<div id="cheatContainer">
  <input type="text" id="cheatInput" placeholder="Type Here">
  <button id="cheatButton">Activate</button>
  <p id="cheatDisplay"></p>
</div>

<p id="instructions">
1. Use the arrow keys to travel between rooms. <br>
2. Navigate the mansion to collect all six weapons. <br>
3. Avoid the guards! Each guard hit costs a life. <br>
4. You have 3 lives. Lose all, and it's Game Over. <br>
5. Check the map to view your location.
</p>

<div id="buttonControls">
  <button data-dir="up">▲</button><br>
  <button data-dir="left">◀</button>
  <button data-dir="down">▼</button>
  <button data-dir="right">▶</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mapCanvas = document.getElementById('mapCanvas');
const mapCtx = mapCanvas.getContext('2d');

const roomInfo = document.getElementById("roomInfo");
const scoreInfo = document.getElementById("scoreInfo");
const weaponsInfo = document.getElementById("weaponsInfo");
const livesInfo = document.getElementById("livesInfo");
const cheatDisplay = document.getElementById("cheatDisplay");

const player = {x:50,y:50,w:25,h:25,speed:3};

let score = 0;
let collected = [];
let currentRoom = "BALLROOM";
let showMap = false;
let lives = 3;
let gameOver = false;

let guards = [
 {x:200,y:150,w:25,h:25,speed:2,dx:1,dy:0,room:"BALLROOM"},
 {x:500,y:400,w:25,h:25,speed:1.5,dx:0,dy:1,room:"DINING ROOM"}
];

let requiredWeapons = 6;
let deathPenalty = 1;

// ---------------- CHEAT CODE COOLDOWNS ----------------
let activeCheats = {}; // tracks active cheats with timeout

function activateTimedCheat(name, duration, effectFn, deactivateFn){
    if(activeCheats[name]) { alert(name+" cheat is already active!"); return; }
    effectFn();
    cheatDisplay.textContent = "Cheat activated: " + name;
    activeCheats[name] = setTimeout(()=>{
        deactivateFn();
        cheatDisplay.textContent = "Cheat deactivated: " + name;
        delete activeCheats[name];
    }, duration);
}

// ---------------- ROOMS ----------------
const ROOMS = {
  "KITCHEN":{floor:1,weapons:[{name:"Knife",x:50,y:50,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:789,y:250,w:11,h:100,to:"BALLROOM"}],stairs:null},
  "BALLROOM":{floor:1,weapons:[{name:"Candlestick",x:300,y:100,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:0,y:250,w:11,h:100,to:"KITCHEN"},{x:350,y:589,w:100,h:11,to:"DINING ROOM"},{x:789,y:100,w:11,h:100,to:"HALL"}],stairs:null},
  "HALL":{floor:1,weapons:[{name:"Pistol",x:200,y:100,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:0,y:100,w:11,h:100,to:"BALLROOM"}],stairs:null},
  "DINING ROOM":{floor:1,weapons:[{name:"Wrench",x:100,y:50,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:350,y:0,w:100,h:11,to:"BALLROOM"}],stairs:{x:740,y:540,w:50,h:50,to:"ART ROOM"},objects:[{type:"circle",x:400,y:300,radius:50,color:"#FFFF99"}]},
  "ART ROOM":{floor:2,weapons:[{name:"Lead Pipe",x:600,y:100,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:0,y:250,w:11,h:100,to:"CONSERVATORY"}],stairs:{x:10,y:540,w:50,h:50,to:"DINING ROOM"},objects:[{type:"rect",x:100,y:100,w:80,h:50,color:"#FF0000"},{type:"rect",x:600,y:100,w:80,h:50,color:"#00FF00"},{type:"rect",x:100,y:400,w:80,h:50,color:"#0000FF"},{type:"rect",x:600,y:400,w:80,h:50,color:"#FFFF00"}]},
  "CONSERVATORY":{floor:2,weapons:[{name:"Rope",x:600,y:50,w:20,h:20}],walls:[{x:0,y:0,w:800,h:10},{x:0,y:0,w:10,h:600},{x:790,y:0,w:10,h:600},{x:0,y:590,w:800,h:10}],doors:[{x:789,y:250,w:11,h:100,to:"ART ROOM"}],stairs:null,objects:[{type:"circle",x:100,y:100,radius:20,color:"#228B22"},{type:"circle",x:300,y:150,radius:20,color:"#228B22"},{type:"circle",x:500,y:100,radius:20,color:"#228B22"},{type:"circle",x:200,y:300,radius:20,color:"#228B22"},{type:"circle",x:600,y:200,radius:20,color:"#228B22"}]}
};

// ---------------- CHEAT CODES ----------------
const cheatCodes = {
  "ANZPYL": () => activateTimedCheat(
    "ANZPYL", 5000,
    ()=>{ for(let i=0;i<15;i++){guards.push({x:Math.random()*700+50,y:Math.random()*500+50,w:25,h:25,speed:1+Math.random()*2,dx:Math.floor(Math.random()*3)-1,dy:Math.floor(Math.random()*3)-1,room:currentRoom});} },
    ()=>{ guards.splice(-15,15); }
  ),
  "PSPTVX": () => { requiredWeapons += 18; spawnExtraWeapons(18); },
  "ZKYEKO": () => activateTimedCheat(
    "ZKYEKO", 5000,
    ()=>{
        let allRooms = Object.keys(ROOMS);
        let changed=0;
        for(const r of allRooms){
          for(const d of ROOMS[r].doors){
            if(changed>=3) return;
            let wrong;
            do { wrong = allRooms[Math.floor(Math.random()*allRooms.length)]; }
            while(wrong===d.to);
            d.to = wrong;
            changed++;
          }
        }
    },
    ()=>{ /* Optionally revert doors if you want */ }
  ),
  "LNVNLS": () => { lives+=8; updateHUD(); },
  "VKOGPZ": () => {
    let allRooms = Object.keys(ROOMS);
    for(let i=0;i<9;i++){
      const from = ROOMS[allRooms[Math.floor(Math.random()*allRooms.length)]];
      const to = allRooms[Math.floor(Math.random()*allRooms.length)];
      from.doors.push({x:(Math.random()<0.5?0:1)*800, y:Math.random()*500+20, w:20, h:80, to});
    }
  },
  "NKUGLA": () => activateTimedCheat(
    "NKUGLA", 5000,
    ()=>{ deathPenalty = 4; },
    ()=>{ deathPenalty = 1; }
  )
};

// ---------- CHEAT INPUT ----------
const cheatInput = document.getElementById('cheatInput');
const cheatButton = document.getElementById('cheatButton');

function activateCheat(code){
  code = code.toUpperCase();
  if(cheatCodes[code]){
    cheatCodes[code]();
    cheatInput.value = "";
    updateHUD();
  } else {
    cheatDisplay.textContent = "Invalid cheat: " + code;
  }
}
cheatButton.addEventListener('click', ()=>activateCheat(cheatInput.value));
cheatInput.addEventListener('keydown', e=>{ if(e.key==="Enter") activateCheat(cheatInput.value); });

// ---------- OTHER FUNCTIONS ----------
function spawnExtraWeapons(n){
 const rooms=Object.values(ROOMS);
 for(let i=0;i<n;i++){
   const room=rooms[Math.floor(Math.random()*rooms.length)];
   room.weapons.push({name:"Bonus"+i, x:Math.random()*700+50, y:Math.random()*500+50, w:20, h:20});
 }
}

// HUD, movement, collisions, drawing etc. remain the same as your original code
// For brevity I’m not repeating the entire movement/collision/draw code here
// But they can be copied directly from your original file

</script>
</body>
</html>
